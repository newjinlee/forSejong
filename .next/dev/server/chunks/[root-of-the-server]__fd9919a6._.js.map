{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///Users/newjinlee/Documents/GitHub/forSejong/app/api/login/route.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport axios from 'axios';\nimport * as cheerio from 'cheerio';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ message: 'Method not allowed' });\n  }\n\n  const { id, password } = req.body;\n  \n  // 1. 학교 서버 로그인 URL & 정보 페이지 URL 설정\n  const LOGIN_URL = 'https://대양휴머니티칼리지_도메인/login_proc_url...'; \n  const INFO_URL = 'https://대양휴머니티칼리지_도메인/mypage/index.do'; // 실제 정보가 있는 페이지\n\n  try {\n    // ---------------------------------------------------------\n    // 단계 1: 로그인 요청 (쿠키 획득 목적)\n    // ---------------------------------------------------------\n    const loginResponse = await axios.post(\n      LOGIN_URL, \n      new URLSearchParams({ id, password }), // 보통 form-urlencoded 방식임\n      {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          // 필요하다면 User-Agent 등 추가\n        },\n        maxRedirects: 0, // 리다이렉트 자동 처리 방지 (쿠키 놓칠 수 있음)\n        validateStatus: (status) => status < 400 // 302 리다이렉트도 에러로 보지 않음\n      }\n    );\n\n    // 학교 서버가 준 'set-cookie' 헤더를 가져옵니다.\n    // 보통 배열 형태거나 문자열입니다. 이걸 그대로 다음 요청에 써야 합니다.\n    const rawCookies = loginResponse.headers['set-cookie'];\n\n    if (!rawCookies) {\n      return res.status(401).json({ message: '로그인 실패: 세션 쿠키를 받지 못했습니다.' });\n    }\n\n    // ---------------------------------------------------------\n    // 단계 2: 획득한 쿠키를 달고 정보 페이지(GET) 요청\n    // ---------------------------------------------------------\n    const infoResponse = await axios.get(INFO_URL, {\n      headers: {\n        Cookie: rawCookies, // 여기서 쿠키를 실어 보냅니다.\n      },\n    });\n\n    // ---------------------------------------------------------\n    // 단계 3: HTML 파싱 (Cheerio 사용)\n    // ---------------------------------------------------------\n    const $ = cheerio.load(infoResponse.data);\n\n    // *중요*: 실제 HTML 구조에 맞춰 선택자(Selector)를 수정해야 합니다.\n    // 크롬 개발자 도구(F12) -> 해당 요소 우클릭 -> Copy -> Copy selector 사용 추천\n    const name = $('#header > div.user_info > span.name').text().trim(); \n    const department = $('.department_info').text().trim();\n    const readingStatus = $('.reading_auth_status').text().trim(); // 예시 클래스명\n\n    // ---------------------------------------------------------\n    // 단계 4: 클라이언트에게 최종 데이터 응답\n    // ---------------------------------------------------------\n    return res.status(200).json({\n      message: '로그인 및 조회 성공',\n      user: {\n        id,\n        name: name || '이름 파싱 실패',\n        department: department || '학과 정보 없음',\n        readingStatus: readingStatus || '정보 없음'\n      }\n    });\n\n  } catch (error) {\n    console.error(error);\n    return res.status(500).json({ message: '서버 에러 발생', error: String(error) });\n  }\n}"],"names":[],"mappings":";;;;AACA;AACA;AAAA;;;AAEe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG,IAAI,IAAI;IAEjC,mCAAmC;IACnC,MAAM,YAAY;IAClB,MAAM,WAAW,yCAAyC,gBAAgB;IAE1E,IAAI;QACF,4DAA4D;QAC5D,0BAA0B;QAC1B,4DAA4D;QAC5D,MAAM,gBAAgB,MAAM,kJAAK,CAAC,IAAI,CACpC,WACA,IAAI,gBAAgB;YAAE;YAAI;QAAS,IACnC;YACE,SAAS;gBACP,gBAAgB;YAElB;YACA,cAAc;YACd,gBAAgB,CAAC,SAAW,SAAS,IAAI,uBAAuB;QAClE;QAGF,mCAAmC;QACnC,2CAA2C;QAC3C,MAAM,aAAa,cAAc,OAAO,CAAC,aAAa;QAEtD,IAAI,CAAC,YAAY;YACf,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,SAAS;YAA2B;QACpE;QAEA,4DAA4D;QAC5D,kCAAkC;QAClC,4DAA4D;QAC5D,MAAM,eAAe,MAAM,kJAAK,CAAC,GAAG,CAAC,UAAU;YAC7C,SAAS;gBACP,QAAQ;YACV;QACF;QAEA,4DAA4D;QAC5D,6BAA6B;QAC7B,4DAA4D;QAC5D,MAAM,IAAI,iKAAY,CAAC,aAAa,IAAI;QAExC,gDAAgD;QAChD,6DAA6D;QAC7D,MAAM,OAAO,EAAE,uCAAuC,IAAI,GAAG,IAAI;QACjE,MAAM,aAAa,EAAE,oBAAoB,IAAI,GAAG,IAAI;QACpD,MAAM,gBAAgB,EAAE,wBAAwB,IAAI,GAAG,IAAI,IAAI,UAAU;QAEzE,4DAA4D;QAC5D,0BAA0B;QAC1B,4DAA4D;QAC5D,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,SAAS;YACT,MAAM;gBACJ;gBACA,MAAM,QAAQ;gBACd,YAAY,cAAc;gBAC1B,eAAe,iBAAiB;YAClC;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAY,OAAO,OAAO;QAAO;IAC1E;AACF"}}]
}