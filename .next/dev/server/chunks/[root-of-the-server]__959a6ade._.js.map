{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/newjinlee/Documents/GitHub/forSejong/app/api/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport async function POST(request: Request) {\n  try {\n    // 1. 클라이언트에서 보낸 ID/PW 받기\n    const { id, password } = await request.json();\n\n    if (!id || !password) {\n      return NextResponse.json(\n        { message: '학번과 비밀번호를 입력해주세요.' },\n        { status: 400 }\n      );\n    }\n\n    // 2. 세종대 포털로 보낼 데이터 준비 (Python 코드의 data={...} 부분)\n    const formData = new URLSearchParams();\n    formData.append('mainLogin', 'Y');\n    formData.append('rtUrl', 'blackboard.sejong.ac.kr');\n    formData.append('id', id);\n    formData.append('password', password);\n\n    // 3. 실제 세종대 서버로 요청 전송 (Python의 requests.post 번역)\n    const sejongResponse = await fetch('https://portal.sejong.ac.kr/jsp/login/login_action.jsp', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Referer': 'https://portal.sejong.ac.kr',\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\n      },\n      body: formData,\n    });\n\n    // 4. 응답 처리 및 성공 여부 확인\n    const setCookieHeader = sejongResponse.headers.get('set-cookie') || '';\n    const responseText = await sejongResponse.text();\n\n    // Python 코드: 'ssotoken' in response.headers.get('Set-Cookie', '')\n    const isLoginSuccess = setCookieHeader.includes('ssotoken');\n\n    if (isLoginSuccess) {\n      // --- 로그인 성공 ---\n      \n      // (선택사항) 학교 서버가 준 쿠키를 파싱해서 내 브라우저에 심고 싶다면 여기서 처리\n      // 여기서는 간단히 성공 메시지만 보냅니다.\n      \n      return NextResponse.json({ \n        message: '로그인 성공',\n        user: { id: id } // 필요하면 이름 등 추가 정보 파싱 필요\n      }, { status: 200 });\n\n    } else {\n      // --- 로그인 실패 (에러 원인 분석) ---\n      // Python 코드의 _get_response_result 함수 로직 (Regex)\n      // var result = '...'; 형태를 찾습니다.\n      const match = responseText.match(/var result = '(.*)';/);\n      const errorCode = match ? match[1] : null;\n\n      let errorMessage = '로그인에 실패했습니다.';\n      \n      // Python 코드의 에러 메시지 매핑 참고\n      if (errorCode === 'erridpwd' || errorCode === 'Error') {\n        errorMessage = '아이디 또는 비밀번호가 일치하지 않습니다.';\n      } else if (errorCode === 'pwsNeedChg') {\n        errorMessage = '비밀번호 변경이 필요하여 계정이 잠겼습니다.';\n      } else if (errorCode === 'invalid') {\n        errorMessage = '제한된 아이디입니다.';\n      }\n\n      return NextResponse.json(\n        { message: errorMessage, code: errorCode },\n        { status: 401 }\n      );\n    }\n\n  } catch (error) {\n    console.error('Login Error:', error);\n    return NextResponse.json(\n      { message: '서버 내부 오류가 발생했습니다.' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,yBAAyB;QACzB,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3C,IAAI,CAAC,MAAM,CAAC,UAAU;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAoB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,kDAAkD;QAClD,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,aAAa;QAC7B,SAAS,MAAM,CAAC,SAAS;QACzB,SAAS,MAAM,CAAC,MAAM;QACtB,SAAS,MAAM,CAAC,YAAY;QAE5B,iDAAiD;QACjD,MAAM,iBAAiB,MAAM,MAAM,0DAA0D;YAC3F,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,WAAW;gBACX,cAAc;YAChB;YACA,MAAM;QACR;QAEA,sBAAsB;QACtB,MAAM,kBAAkB,eAAe,OAAO,CAAC,GAAG,CAAC,iBAAiB;QACpE,MAAM,eAAe,MAAM,eAAe,IAAI;QAE9C,kEAAkE;QAClE,MAAM,iBAAiB,gBAAgB,QAAQ,CAAC;QAEhD,IAAI,gBAAgB;YAClB,iBAAiB;YAEjB,iDAAiD;YACjD,yBAAyB;YAEzB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,MAAM;oBAAE,IAAI;gBAAG,EAAE,wBAAwB;YAC3C,GAAG;gBAAE,QAAQ;YAAI;QAEnB,OAAO;YACL,4BAA4B;YAC5B,gDAAgD;YAChD,gCAAgC;YAChC,MAAM,QAAQ,aAAa,KAAK,CAAC;YACjC,MAAM,YAAY,QAAQ,KAAK,CAAC,EAAE,GAAG;YAErC,IAAI,eAAe;YAEnB,0BAA0B;YAC1B,IAAI,cAAc,cAAc,cAAc,SAAS;gBACrD,eAAe;YACjB,OAAO,IAAI,cAAc,cAAc;gBACrC,eAAe;YACjB,OAAO,IAAI,cAAc,WAAW;gBAClC,eAAe;YACjB;YAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAc,MAAM;YAAU,GACzC;gBAAE,QAAQ;YAAI;QAElB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;QAAoB,GAC/B;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}