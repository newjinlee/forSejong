{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///Users/newjinlee/Documents/GitHub/forSejong/app/api/login/route.ts"],"sourcesContent":["// app/api/login/route.ts\nimport { NextResponse } from 'next/server';\nimport axios from 'axios';\nimport * as cheerio from 'cheerio';\n\nexport async function POST(request: Request) {\n  try {\n    // 1. 요청 데이터 받기 (req.body 대신 request.json() 사용)\n    const body = await request.json();\n    const { id, password } = body;\n\n    // 학교 서버 설정\n    const LOGIN_URL = 'https://portal.sejong.ac.kr/jsp/login/loginSSL.jsp?rtUrl=http%3A%2F%2Fclassic.sejong.ac.kr%2F_custom%2Fsejong%2Fsso%2Fsso-return.jsp%3FreturnUrl%3Dhttps%253A%252F%252Fclassic.sejong.ac.kr%252Fclassic%252Findex.do'; // 정확한 로그인 주소 필요\n    const INFO_URL = 'https://classic.sejong.ac.kr/classic/reading/status.do'; // 정보가 있는 페이지 주소\n\n    // 2. 학교 서버로 로그인 요청 (쿠키 획득) \n    const params = new URLSearchParams();\n    params.append('id', id);\n    params.append('password', password);\n\n    const loginResponse = await axios.post(LOGIN_URL, params, {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      maxRedirects: 0, \n      validateStatus: (status) => status < 400, // 302 리다이렉트 허용\n    });\n\n    const rawCookies = loginResponse.headers['set-cookie'];\n\n    if (!rawCookies) {\n      return NextResponse.json(\n        { message: '로그인 실패: 세션 쿠키를 받지 못했습니다.' },\n        { status: 401 }\n      );\n    }\n\n    // 3. 쿠키 들고 정보 페이지 요청\n    const infoResponse = await axios.get(INFO_URL, {\n      headers: {\n        Cookie: rawCookies, \n        // 필요 시 User-Agent 추가\n      },\n    });\n\n    // 4. HTML 파싱 (Cheerio)\n    const $ = cheerio.load(infoResponse.data);\n\n    // *[중요] 선택자는 실제 개발자 도구로 확인해서 수정해야 합니다.*\n    // 아래는 예시입니다.\n    const name = $('.user_name_class').text().trim() || '이름 파싱 실패'; \n    const department = $('.dept_class').text().trim() || '학과 파싱 실패';\n    \n    // 5. 결과 반환 (NextResponse 사용)\n    return NextResponse.json({\n      message: '성공',\n      data: {\n        id,\n        name,\n        department,\n        // 기타 필요한 데이터...\n      }\n    });\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error: any) {\n    console.error('API Error:', error);\n    return NextResponse.json(\n      { message: '서버 내부 오류', error: error.message },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA,yBAAyB;AACzB;AACA;AACA;AAAA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,+CAA+C;QAC/C,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,EAAE,EAAE,QAAQ,EAAE,GAAG;QAEzB,WAAW;QACX,MAAM,YAAY,wNAAwN,gBAAgB;QAC1P,MAAM,WAAW,0DAA0D,gBAAgB;QAE3F,4BAA4B;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,CAAC,MAAM;QACpB,OAAO,MAAM,CAAC,YAAY;QAE1B,MAAM,gBAAgB,MAAM,kJAAK,CAAC,IAAI,CAAC,WAAW,QAAQ;YACxD,SAAS;gBACP,gBAAgB;YAClB;YACA,cAAc;YACd,gBAAgB,CAAC,SAAW,SAAS;QACvC;QAEA,MAAM,aAAa,cAAc,OAAO,CAAC,aAAa;QAEtD,IAAI,CAAC,YAAY;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAA2B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,eAAe,MAAM,kJAAK,CAAC,GAAG,CAAC,UAAU;YAC7C,SAAS;gBACP,QAAQ;YAEV;QACF;QAEA,uBAAuB;QACvB,MAAM,IAAI,iKAAY,CAAC,aAAa,IAAI;QAExC,wCAAwC;QACxC,aAAa;QACb,MAAM,OAAO,EAAE,oBAAoB,IAAI,GAAG,IAAI,MAAM;QACpD,MAAM,aAAa,EAAE,eAAe,IAAI,GAAG,IAAI,MAAM;QAErD,6BAA6B;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ;gBACA;gBACA;YAEF;QACF;IAEF,8DAA8D;IAC9D,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAY,OAAO,MAAM,OAAO;QAAC,GAC5C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}