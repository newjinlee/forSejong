{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///Users/newjinlee/Documents/GitHub/forSejong/app/api/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport axios from \"axios\";\nimport { wrapper } from \"axios-cookiejar-support\";\nimport * as cheerio from \"cheerio\";\nimport { CookieJar } from \"tough-cookie\";\n\nexport async function POST(request: Request) {\n  const { id, pw } = await request.json();\n\n  if (!id || !pw) {\n    return NextResponse.json(\n      { success: false, message: \"ID와 PW를 입력해주세요.\" },\n      { status: 400 }\n    );\n  }\n\n  // 1. 쿠키 관리를 위한 설정 (세션 유지)\n  const jar = new CookieJar();\n  const client = wrapper(\n    axios.create({\n      jar,\n      withCredentials: true,\n      headers: {\n        \"User-Agent\":\n          \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n      },\n    })\n  );\n\n  try {\n    // 2. 로그인 페이지 접속 (초기 쿠키/세션 획득)\n    // 두드림(DoDream) 사이트를 예시로 사용 (포털 계정과 동일)\n    const loginUrl = \"https://do.sejong.ac.kr/common/user/login.do\";\n\n    // 3. 로그인 요청 전송\n    // 실제 학교 사이트의 Form 데이터 구조에 맞춰 전송\n    const formData = new URLSearchParams();\n    formData.append(\"userId\", id);\n    formData.append(\"userPw\", pw); // 비밀번호 필드명 확인 필요 (보통 password, userPw 등)\n    // *주의: 사이트마다 필드명(userId vs id)이 다를 수 있으므로 크롬 개발자 도구(Network 탭) 확인 필요\n\n    const response = await client.post(loginUrl, formData, {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      },\n    });\n\n    // 4. 로그인 성공 여부 판별\n    // 보통 로그인 실패 시 경고창(alert) 내용이 HTML에 포함되거나, URL이 변경되지 않음\n    const html = response.data;\n    const $ = cheerio.load(html);\n\n    // 실패 시 보통 '아이디 또는 비밀번호가 일치하지 않습니다' 같은 텍스트가 뜸\n    // 혹은 성공 시 리다이렉트가 발생하거나 특정 로그인 후 요소가 보임\n\n    // 간단한 성공 판별 로직 (예시): 로그인 후 메인 페이지로 리다이렉트 되었는지 확인\n    // 또는 응답 HTML 내에 사용자 이름이나 로그아웃 버튼이 있는지 확인\n    const isSuccess =\n      !html.includes(\"로그인 정보가 일치하지 않습니다\") &&\n      response.request.res.responseUrl !== loginUrl;\n\n    if (isSuccess) {\n      // (선택) 여기서 추가로 크롤링해서 이름/학과 정보를 가져올 수 있음\n      return NextResponse.json({\n        success: true,\n        message: \"로그인 성공\",\n        user: { id }, // 필요시 이름 등 추가 정보 반환\n      });\n    } else {\n      return NextResponse.json(\n        { success: false, message: \"로그인 실패: 아이디/비번을 확인해주세요.\" },\n        { status: 401 }\n      );\n    }\n  } catch (error) {\n    console.error(\"Login Error:\", error);\n    return NextResponse.json(\n      { success: false, message: \"서버 오류 발생\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AAAA;AACA;;;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,IAAI;IAErC,IAAI,CAAC,MAAM,CAAC,IAAI;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAkB,GAC7C;YAAE,QAAQ;QAAI;IAElB;IAEA,0BAA0B;IAC1B,MAAM,MAAM,IAAI,+JAAS;IACzB,MAAM,SAAS,IAAA,2KAAO,EACpB,kJAAK,CAAC,MAAM,CAAC;QACX;QACA,iBAAiB;QACjB,SAAS;YACP,cACE;QACJ;IACF;IAGF,IAAI;QACF,8BAA8B;QAC9B,uCAAuC;QACvC,MAAM,WAAW;QAEjB,eAAe;QACf,gCAAgC;QAChC,MAAM,WAAW,IAAI;QACrB,SAAS,MAAM,CAAC,UAAU;QAC1B,SAAS,MAAM,CAAC,UAAU,KAAK,yCAAyC;QACxE,qEAAqE;QAErE,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,UAAU,UAAU;YACrD,SAAS;gBACP,gBAAgB;YAClB;QACF;QAEA,kBAAkB;QAClB,uDAAuD;QACvD,MAAM,OAAO,SAAS,IAAI;QAC1B,MAAM,IAAI,iKAAY,CAAC;QAEvB,6CAA6C;QAC7C,uCAAuC;QAEvC,iDAAiD;QACjD,yCAAyC;QACzC,MAAM,YACJ,CAAC,KAAK,QAAQ,CAAC,wBACf,SAAS,OAAO,CAAC,GAAG,CAAC,WAAW,KAAK;QAEvC,IAAI,WAAW;YACb,wCAAwC;YACxC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,SAAS;gBACT,MAAM;oBAAE;gBAAG;YACb;QACF,OAAO;YACL,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA0B,GACrD;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAW,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}